<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Image Analyzer Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      /* Custom styles */
      .bg-grid-gray-100 {
        background-image: radial-gradient(#f0f0f0 1px, transparent 1px);
        background-size: 16px 16px;
      }

      .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
      }

      /* Custom textarea scrollbar */
      textarea::-webkit-scrollbar {
        width: 8px;
      }

      textarea::-webkit-scrollbar-track {
        background: rgba(200, 200, 200, 0.1);
        border-radius: 4px;
      }

      textarea::-webkit-scrollbar-thumb {
        background: rgba(255, 100, 0, 0.2);
        border-radius: 4px;
      }

      textarea::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 100, 0, 0.4);
      }

      /* Image preview styling */
      .image-preview {
        max-width: 100px;
        max-height: 100px;
        object-fit: contain;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        transition: all 0.3s ease;
      }

      .image-preview:hover {
        transform: scale(1.5);
        z-index: 10;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      /* Loading spinner */
      .spinner {
        width: 24px;
        height: 24px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Table styling */
      .table-container {
        background-color: white;
        padding: 25px;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        overflow-x: auto;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin: 0 auto;
        font-size: 0.95rem;
      }

      th,
      td {
        text-align: left;
        padding: 12px 15px;
        border-bottom: 1px solid #e2e8f0;
        height: 70px; /* Adjusted height for location info only */
        vertical-align: middle;
      }

      th {
        background-color: #2d3748;
        color: white;
        position: sticky;
        top: 0;
        font-weight: 600;
        height: auto; /* Allow header natural height */
      }

      tr:nth-child(even) {
        background-color: #f8f9fa;
      }

      tr:hover {
        background-color: #ebf8ff;
        transition: all 0.3s ease;
      }

      /* Location badge styling */
      .location-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
        margin: 1px;
      }

      .location-header {
        background-color: #dbeafe;
        color: #1e40af;
      }
      .location-main {
        background-color: #dcfce7;
        color: #166534;
      }
      .location-sidebar {
        background-color: #fef3c7;
        color: #92400e;
      }
      .location-footer {
        background-color: #e5e7eb;
        color: #374151;
      }
      .location-navigation {
        background-color: #e0e7ff;
        color: #3730a3;
      }
      .location-content {
        background-color: #f3e8ff;
        color: #6b21a8;
      }
      .location-unknown {
        background-color: #fecaca;
        color: #991b1b;
      }

      /* Tab styling */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .tab-button {
        transition: all 0.3s ease;
      }

      .tab-button.active {
        background: linear-gradient(135deg, #f97316, #dc2626);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50 text-gray-800">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-gray-900 shadow-lg">
      <div class="max-w-6xl mx-auto px-4">
        <div class="flex items-center justify-between py-4">
          <div
            class="flex items-center space-x-2 transition duration-300 hover:scale-105"
          >
            <a
              href="index.html"
              class="flex items-center space-x-2 text-decoration-none"
            >
              <div
                class="bg-gradient-to-br from-orange-500 to-red-600 p-2 rounded-[3px] relative overflow-hidden shadow-lg"
              >
                <div
                  class="absolute inset-0 bg-orange-400 rounded-full blur-md opacity-60 scale-75 animate-pulse"
                ></div>
                <i
                  id="header-nut-icon"
                  class="h-5 w-5 text-white relative z-10 pb-0.5"
                ></i>
                <div
                  class="w-4/5 h-1 bg-white absolute bottom-1 left-0 ml-1 rounded-[1px]"
                ></div>
              </div>
              <span class="text-2xl font-bold">
                <span
                  class="text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500"
                >
                  O<span class="text-white">Tools</span>
                </span>
              </span>
            </a>
          </div>
          <nav class="hidden md:flex space-x-6 items-center">
            <a
              href="index.html"
              class="text-white transition font-medium hover:text-orange-300"
              >Tools</a
            >
            <span
              class="text-gray-400 hover:text-gray-300 cursor-not-allowed relative group"
              >Team</span
            >
            <div class="h-5 w-px bg-gray-600"></div>
            <span
              class="text-gray-400 hover:text-gray-300 cursor-not-allowed relative group"
              >Contact</span
            >
          </nav>
        </div>
      </div>
    </header>

    <!-- Header highlight decoration -->
    <div
      class="h-1 w-full bg-gradient-to-r from-orange-500 via-red-500 to-purple-600"
    ></div>

    <!-- Main Content Section -->
    <div class="py-10 bg-white relative min-h-[80vh]">
      <!-- Subtle background pattern -->
      <div class="absolute inset-0 bg-grid-gray-100 opacity-30"></div>

      <div class="max-w-5xl mx-auto px-4 relative z-10">
        <!-- Page Title -->
        <div class="mb-8 text-center">
          <h1 class="text-3xl font-bold text-gray-800">
            Enhanced Image Analyzer
          </h1>
          <p class="text-gray-600 mt-2">
            Extract and analyze images with detailed information from websites
          </p>
        </div>

        <!-- Analysis Mode Tabs -->
        <div class="mb-8">
          <div class="flex justify-center space-x-4 mb-6">
            <button
              id="tab-url"
              class="tab-button active px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300"
            >
              üåê Images Analyzer
            </button>
            <button
              id="tab-urls"
              class="tab-button px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300"
            >
              üìã Image URLs Analysis
            </button>
          </div>

          <!-- Images Analyzer Tab -->
          <div id="content-url" class="tab-content active">
            <div
              class="bg-blue-50 rounded-xl p-6 mb-6 border-l-4 border-blue-500"
            >
              <h3
                class="text-lg font-semibold text-blue-800 mb-2 flex items-center"
              >
                <i id="globe-icon" class="h-5 w-5 mr-2"></i>
                Images Analyzer
              </h3>
              <p class="text-blue-700">
                Enter a website URL to automatically extract and analyze all
                images from the site. The tool will crawl the website, discover
                images through multiple methods, and generate comprehensive
                reports with detailed information about each image found.
              </p>
            </div>

            <div class="relative">
              <div class="flex items-center mb-3 space-x-2">
                <div class="bg-blue-600 p-1.5 rounded-md">
                  <i id="url-icon" class="h-4 w-4 text-white"></i>
                </div>
                <label
                  for="website-url"
                  class="text-lg font-semibold text-gray-700"
                  >Website URL</label
                >
              </div>

              <input
                type="url"
                id="website-url"
                class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 transition-all duration-300 shadow-inner bg-white bg-opacity-80 text-lg"
                placeholder="https://example.com"
              />

              <!-- Advanced Options -->
              <div class="mt-4">
                <button
                  id="advanced-options-toggle"
                  class="flex items-center justify-between w-full p-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200 text-left"
                >
                  <span class="font-semibold text-gray-700"
                    >Advanced Options</span
                  >
                  <svg
                    id="advanced-options-icon"
                    class="w-5 h-5 text-gray-500 transform transition-transform duration-200"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    ></path>
                  </svg>
                </button>

                <div
                  id="advanced-options-content"
                  class="hidden mt-3 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500"
                >
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-600 mb-1"
                        >Scroll Iterations</label
                      >
                      <input
                        type="number"
                        id="scroll-iterations"
                        value="3"
                        min="1"
                        max="50"
                        class="w-full p-2 border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-600 mb-1"
                        >Scroll Delay (ms)</label
                      >
                      <input
                        type="number"
                        id="scroll-delay"
                        value="2000"
                        min="500"
                        max="10000"
                        step="500"
                        class="w-full p-2 border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-600 mb-1"
                        >Page Load Wait (s)</label
                      >
                      <input
                        type="number"
                        id="page-load-wait"
                        value="5"
                        min="3"
                        max="60"
                        class="w-full p-2 border border-gray-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Highlight Options -->
              <div class="mt-4">
                <button
                  id="highlight-options-toggle-url"
                  class="flex items-center justify-between w-full p-3 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors duration-200 text-left"
                >
                  <span class="font-semibold text-blue-800"
                    >Highlight Options</span
                  >
                  <svg
                    id="highlight-options-icon-url"
                    class="w-5 h-5 text-blue-600 transform transition-transform duration-200"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    ></path>
                  </svg>
                </button>

                <div
                  id="highlight-options-content-url"
                  class="hidden mt-3 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500"
                >
                  <div class="flex items-center space-x-4">
                    <div class="flex-1">
                      <label
                        class="block text-sm font-medium text-blue-800 mb-1"
                        >Highlight images larger than (KB)</label
                      >
                      <input
                        type="number"
                        id="highlight-size-url"
                        placeholder="e.g., 500"
                        min="0"
                        step="1"
                        class="w-full p-2 border border-blue-300 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 bg-white"
                      />
                    </div>
                    <div class="flex items-end">
                      <div class="text-sm text-blue-700">
                        <p class="mb-1">üí° <strong>Tip:</strong></p>
                        <p>Leave empty for no highlighting</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Image URLs Analysis Tab -->
          <div id="content-urls" class="tab-content">
            <div
              class="bg-orange-50 rounded-xl p-6 mb-6 border-l-4 border-orange-500"
            >
              <h3
                class="text-lg font-semibold text-orange-800 mb-2 flex items-center"
              >
                <i id="list-icon" class="h-5 w-5 mr-2"></i>
                Image URLs Analysis
              </h3>
              <p class="text-orange-700 mb-2">
                Paste specific image URLs (one per line) to analyze their
                properties including file sizes, formats, and generate detailed
                reports.
              </p>
              <p class="text-sm text-orange-600">
                <strong>Limit:</strong> Maximum 1000 URLs per analysis for
                optimal performance.
              </p>
            </div>

            <div class="relative">
              <div class="flex items-center mb-3 space-x-2">
                <div class="bg-orange-600 p-1.5 rounded-md">
                  <i id="data-icon" class="h-4 w-4 text-white"></i>
                </div>
                <label
                  for="data-input"
                  class="text-lg font-semibold text-gray-700"
                  >Enter Image URLs (one per line)</label
                >
              </div>

              <textarea
                id="data-input"
                rows="12"
                class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 transition-all duration-300 shadow-inner bg-white bg-opacity-80 font-mono text-sm"
                placeholder="Paste image URLs here, one per line...
Example:
https://example.com/assets/images/featured/2024/12/Smartphone-Series-A1.webp
https://example.com/content/media/uploads/2023/07/tablet-pro-model.png?version=1.4
https://example.com/files/styles/720x480/public/2025-03/Wireless-Earbuds-X2.jpg
https://example.com/media/gallery/2022/11/Smart-TV-55inch-4K.avif
https://example.com/uploads/images/catalog/2023/05/laptop-gamer-z100.webp
https://example.com/storage/public/images/2024-09/Bluetooth-Speaker-Mini.heic
https://example.com/imgs/banners/featured/2025-01/Fitness-Tracker-V3.jxl?ref=homepage"
              ></textarea>

              <!-- Character count -->
              <div class="flex justify-end mt-1">
                <span id="char-count" class="text-xs text-gray-500"
                  >0 characters, 0 URLs</span
                >
              </div>
            </div>

            <!-- Highlight Options for Image URLs Analysis -->
            <div class="mt-4">
              <button
                id="highlight-options-toggle-urls"
                class="flex items-center justify-between w-full p-3 bg-yellow-100 hover:bg-yellow-200 rounded-lg transition-colors duration-200 text-left"
              >
                <span class="font-semibold text-yellow-800"
                  >Highlight Options</span
                >
                <svg
                  id="highlight-options-icon-urls"
                  class="w-5 h-5 text-yellow-600 transform transition-transform duration-200"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </button>

              <div
                id="highlight-options-content-urls"
                class="hidden mt-3 p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500"
              >
                <div class="flex items-center space-x-4">
                  <div class="flex-1">
                    <label
                      class="block text-sm font-medium text-yellow-800 mb-1"
                      >Highlight images larger than (KB)</label
                    >
                    <input
                      type="number"
                      id="highlight-size-urls"
                      placeholder="e.g., 500"
                      min="0"
                      step="1"
                      class="w-full p-2 border border-yellow-300 rounded-md focus:border-yellow-500 focus:ring focus:ring-yellow-200 bg-white"
                    />
                  </div>
                  <div class="flex items-end">
                    <div class="text-sm text-yellow-700">
                      <p class="mb-1">üí° <strong>Tip:</strong></p>
                      <p>Leave empty for no highlighting</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Download Buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-4 mb-10">
          <!-- HTML Download Button -->
          <button
            id="download-html"
            class="flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform transition-all duration-300 hover:scale-105 w-full sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i id="html-icon" class="h-5 w-5"></i>
            <span>Generate HTML Report</span>
          </button>

          <!-- CSV Download Button -->
          <button
            id="download-csv"
            class="flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform transition-all duration-300 hover:scale-105 w-full sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i id="csv-icon" class="h-5 w-5"></i>
            <span>Generate CSV Report</span>
          </button>
        </div>

        <!-- Progress bar -->
        <div id="progress-container" class="hidden mb-4">
          <div class="flex justify-between mb-1">
            <span id="progress-text" class="text-sm font-medium text-gray-700"
              >Processing...</span
            >
            <span
              id="progress-percent"
              class="text-sm font-medium text-gray-700"
              >0%</span
            >
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 shadow-inner">
            <div
              id="progress-bar"
              class="h-3 rounded-full transition-all duration-300 ease-out bg-gradient-to-r from-blue-500 to-indigo-600"
              style="width: 0%"
            ></div>
          </div>
          <div class="mt-1">
            <span id="progress-detail" class="text-xs text-gray-500"></span>
          </div>
        </div>

        <!-- Results preview -->
        <div id="results-preview" class="hidden table-container">
          <h3
            class="text-lg font-semibold text-gray-800 mb-3 flex items-center"
          >
            <i id="results-icon" class="h-5 w-5 mr-2 text-orange-500"></i>
            Analysis Results
          </h3>
          <div
            id="stats-container"
            class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"
          ></div>
          <div class="overflow-x-auto">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Preview</th>
                  <th>Filename</th>
                  <th>Size (KB)</th>
                  <th>Type</th>
                  <th>Content Type</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody
                id="results-table"
                class="divide-y divide-gray-200"
              ></tbody>
            </table>
          </div>
        </div>

        <!-- Help Section -->
        <div class="bg-gray-100 rounded-xl p-6 shadow-md mt-2">
          <h3
            class="text-lg font-semibold text-gray-800 mb-3 flex items-center"
          >
            <i id="tip-icon" class="h-5 w-5 mr-2 text-orange-500"></i>
            Enhanced Features
          </h3>
          <ul class="space-y-2 text-gray-600">
            <li class="flex items-start">
              <span
                class="bg-orange-100 text-orange-800 p-1 rounded-full mr-2 flex-shrink-0 mt-0.5"
              >
                <i id="check-icon-1" class="h-3 w-3"></i>
              </span>
              <strong>Images Analyzer:</strong> Enter a website URL to
              automatically extract all images from the site
            </li>
            <li class="flex items-start">
              <span
                class="bg-orange-100 text-orange-800 p-1 rounded-full mr-2 flex-shrink-0 mt-0.5"
              >
                <i id="check-icon-2" class="h-3 w-3"></i>
              </span>
              <strong>All Image Formats:</strong> Supports WebP, AVIF, HEIC, JXL
              and all modern image formats
            </li>
            <li class="flex items-start">
              <span
                class="bg-orange-100 text-orange-800 p-1 rounded-full mr-2 flex-shrink-0 mt-0.5"
              >
                <i id="check-icon-3" class="h-3 w-3"></i>
              </span>
              <strong>Detailed Reports:</strong> Generate comprehensive HTML and
              CSV reports with complete image analysis
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer
      class="py-8 bg-gradient-to-b from-gray-800 to-gray-900 text-gray-400 border-t border-gray-700"
    >
      <div class="max-w-6xl mx-auto px-4">
        <div
          class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"
        >
          <div class="flex items-center space-x-2">
            <a
              href="index.html"
              class="flex items-center space-x-2 text-decoration-none"
            >
              <div class="bg-orange-500 p-1.5 rounded-md relative">
                <i id="footer-nut-icon" class="h-4 w-4 text-white"></i>
              </div>
              <span class="text-xl font-bold">
                <span class="text-orange-500"
                  >O<span class="text-white">Tools</span></span
                >
              </span>
            </a>
          </div>
          <p class="text-sm">&copy; 2025 ORANGE. All rights reserved.</p>
          <div class="w-[100px] flex justify-end">
            <p class="text-sm">2.8</p>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Helper function to get icon SVG
      function getIconSVG(iconName) {
        const icons = {
          bolt: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
          "file-text":
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>',
          "file-code":
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></svg>',
          database:
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>',
          check:
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
          lightbulb:
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',
          image:
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>',
          "bar-chart":
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>',
          globe:
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',
          link: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',
          list: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="18" y2="18"/></svg>',
        };
        return icons[iconName] || "";
      }

      // Nut icon SVG
      const nutIconSVG =
        '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>';

      // Initialize icons when page loads
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize all icons
        const iconMappings = {
          "header-nut-icon": nutIconSVG,
          "footer-nut-icon": nutIconSVG,
          "data-icon": getIconSVG("image"),
          "html-icon": getIconSVG("file-code"),
          "csv-icon": getIconSVG("file-text"),
          "tip-icon": getIconSVG("lightbulb"),
          "results-icon": getIconSVG("bar-chart"),
          "globe-icon": getIconSVG("globe"),
          "url-icon": getIconSVG("link"),
          "list-icon": getIconSVG("list"),
          "check-icon-1": getIconSVG("check"),
          "check-icon-2": getIconSVG("check"),
          "check-icon-3": getIconSVG("check"),
        };

        Object.entries(iconMappings).forEach(([id, svg]) => {
          const element = document.getElementById(id);
          if (element) {
            element.innerHTML = svg;
          }
        });

        // Tab functionality
        const tabUrl = document.getElementById("tab-url");
        const tabUrls = document.getElementById("tab-urls");
        const contentUrl = document.getElementById("content-url");
        const contentUrls = document.getElementById("content-urls");

        tabUrl.addEventListener("click", () => {
          tabUrl.classList.add("active");
          tabUrls.classList.remove("active");
          contentUrl.classList.add("active");
          contentUrls.classList.remove("active");
        });

        tabUrls.addEventListener("click", () => {
          tabUrls.classList.add("active");
          tabUrl.classList.remove("active");
          contentUrls.classList.add("active");
          contentUrl.classList.remove("active");
        });

        // Advanced Options dropdown functionality
        const advancedOptionsToggle = document.getElementById(
          "advanced-options-toggle"
        );
        const advancedOptionsContent = document.getElementById(
          "advanced-options-content"
        );
        const advancedOptionsIcon = document.getElementById(
          "advanced-options-icon"
        );

        advancedOptionsToggle.addEventListener("click", () => {
          const isHidden = advancedOptionsContent.classList.contains("hidden");

          if (isHidden) {
            advancedOptionsContent.classList.remove("hidden");
            advancedOptionsIcon.style.transform = "rotate(180deg)";
          } else {
            advancedOptionsContent.classList.add("hidden");
            advancedOptionsIcon.style.transform = "rotate(0deg)";
          }
        });

        // Highlight Options dropdown functionality for Images Analyzer
        const highlightOptionsToggleUrl = document.getElementById(
          "highlight-options-toggle-url"
        );
        const highlightOptionsContentUrl = document.getElementById(
          "highlight-options-content-url"
        );
        const highlightOptionsIconUrl = document.getElementById(
          "highlight-options-icon-url"
        );

        if (highlightOptionsToggleUrl) {
          highlightOptionsToggleUrl.addEventListener("click", () => {
            const isHidden =
              highlightOptionsContentUrl.classList.contains("hidden");

            if (isHidden) {
              highlightOptionsContentUrl.classList.remove("hidden");
              highlightOptionsIconUrl.style.transform = "rotate(180deg)";
            } else {
              highlightOptionsContentUrl.classList.add("hidden");
              highlightOptionsIconUrl.style.transform = "rotate(0deg)";
            }
          });
        }

        // Highlight Options dropdown functionality for Image URLs Analysis
        const highlightOptionsToggleUrls = document.getElementById(
          "highlight-options-toggle-urls"
        );
        const highlightOptionsContentUrls = document.getElementById(
          "highlight-options-content-urls"
        );
        const highlightOptionsIconUrls = document.getElementById(
          "highlight-options-icon-urls"
        );

        if (highlightOptionsToggleUrls) {
          highlightOptionsToggleUrls.addEventListener("click", () => {
            const isHidden =
              highlightOptionsContentUrls.classList.contains("hidden");

            if (isHidden) {
              highlightOptionsContentUrls.classList.remove("hidden");
              highlightOptionsIconUrls.style.transform = "rotate(180deg)";
            } else {
              highlightOptionsContentUrls.classList.add("hidden");
              highlightOptionsIconUrls.style.transform = "rotate(0deg)";
            }
          });
        }

        // Character counter for textarea
        const dataInput = document.getElementById("data-input");
        const charCount = document.getElementById("char-count");

        dataInput.addEventListener("input", function () {
          const count = this.value.length;
          const urls = this.value
            .split("\n")
            .filter((url) => url.trim() !== "");

          let countText = `${count} characters, ${urls.length} URLs`;

          // Add warnings for large inputs
          if (urls.length > 800) {
            countText += " ‚ö†Ô∏è Approaching limit (1000 max)";
            charCount.className = "text-xs text-orange-600 font-medium";
          } else if (urls.length > 500) {
            countText += " ‚ö†Ô∏è Large dataset";
            charCount.className = "text-xs text-yellow-600";
          } else {
            charCount.className = "text-xs text-gray-500";
          }

          charCount.textContent = countText;
        });

        // Download functionality
        setupDownloadFunctionality();
      });

      function setupDownloadFunctionality() {
        const downloadHTML = document.getElementById("download-html");
        const downloadCSV = document.getElementById("download-csv");
        const progressContainer = document.getElementById("progress-container");
        const progressBar = document.getElementById("progress-bar");
        const progressText = document.getElementById("progress-text");
        const progressPercent = document.getElementById("progress-percent");
        const resultsPreview = document.getElementById("results-preview");
        const statsContainer = document.getElementById("stats-container");
        const resultsTable = document.getElementById("results-table");

        // Get current analysis mode
        function getCurrentMode() {
          return document.getElementById("tab-url").classList.contains("active")
            ? "url"
            : "urls";
        }

        // Get input data based on current mode
        function getInputData() {
          const mode = getCurrentMode();
          if (mode === "url") {
            const websiteUrl = document
              .getElementById("website-url")
              .value.trim();
            const scrollIterations =
              parseInt(document.getElementById("scroll-iterations").value) || 3;
            const scrollDelay =
              parseInt(document.getElementById("scroll-delay").value) || 2000;
            const pageLoadWait =
              parseInt(document.getElementById("page-load-wait").value) || 5;
            const highlightSize =
              parseInt(document.getElementById("highlight-size-url").value) ||
              null;

            return {
              mode: "url",
              websiteUrl,
              options: { scrollIterations, scrollDelay, pageLoadWait },
              highlightSize,
            };
          } else {
            const imageUrls = document
              .getElementById("data-input")
              .value.split("\n")
              .filter((url) => url.trim() !== "");
            const highlightSize =
              parseInt(document.getElementById("highlight-size-urls").value) ||
              null;

            return {
              mode: "urls",
              imageUrls,
              highlightSize,
            };
          }
        }

        // Validate input data
        function validateInput(data) {
          if (data.mode === "url") {
            if (!data.websiteUrl) {
              alert("Please enter a website URL!");
              return false;
            }
            if (!data.websiteUrl.match(/^https?:\/\//)) {
              alert(
                "Please enter a valid URL (starting with http:// or https://)"
              );
              return false;
            }
          } else {
            if (data.imageUrls.length === 0) {
              alert("Please enter at least one image URL!");
              return false;
            }
            if (data.imageUrls.length > 1000) {
              alert("Too many URLs! Maximum 1000 URLs allowed per analysis.");
              return false;
            }

            // Check approximate payload size
            const payloadSize = JSON.stringify(data.imageUrls).length;
            if (payloadSize > 40 * 1024 * 1024) {
              // 40MB limit
              alert(
                "URL list too large! Please reduce the number of URLs or split into smaller batches."
              );
              return false;
            }
          }
          return true;
        }

        // Show progress
        function showProgress(text, mode = "html") {
          progressContainer.classList.remove("hidden");
          resultsPreview.classList.add("hidden");
          progressText.textContent = text;
          progressPercent.textContent = "0%";
          progressBar.style.width = "0%";

          // Set progress bar color based on mode/button
          if (mode === "csv") {
            progressBar.className =
              "h-3 rounded-full transition-all duration-300 ease-out bg-gradient-to-r from-blue-500 to-indigo-600";
          } else {
            progressBar.className =
              "h-3 rounded-full transition-all duration-300 ease-out bg-gradient-to-r from-orange-500 to-red-600";
          }
        }

        // Update progress
        function updateProgress(percent, text, detail = "") {
          // Ensure percent is between 0 and 100
          const clampedPercent = Math.max(0, Math.min(100, percent));

          progressBar.style.width = `${clampedPercent}%`;
          progressPercent.textContent = `${clampedPercent}%`;

          if (text) progressText.textContent = text;

          const progressDetail = document.getElementById("progress-detail");
          if (progressDetail && detail) {
            progressDetail.textContent = detail;
          }

          // Keep the original button color even at 100% completion
          // Progress bar color is set in showProgress() and maintained throughout
          if (clampedPercent === 100) {
            setTimeout(() => {
              progressText.textContent = "Complete!";
            }, 300);
          }
        }

        // Hide progress
        function hideProgress() {
          progressContainer.classList.add("hidden");
        }

        // Analyze images
        async function analyzeImages(data, reportMode = "html") {
          const startTime = Date.now();

          try {
            showProgress("Starting analysis...", reportMode);

            let analysisResult;

            if (data.mode === "url") {
              // Images Analyzer
              updateProgress(
                10,
                "Extracting images from website...",
                "Initializing web scraper..."
              );

              const extractResponse = await fetch(
                "http://localhost:3000/api/extract-images",
                {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    url: data.websiteUrl,
                    options: data.options,
                  }),
                }
              );

              if (!extractResponse.ok) {
                throw new Error(
                  `Failed to extract images: ${extractResponse.statusText}`
                );
              }

              const extractData = await extractResponse.json();

              if (!extractData.success) {
                throw new Error(
                  extractData.error || "Failed to extract images"
                );
              }

              updateProgress(
                50,
                "Analyzing extracted images...",
                `Found ${extractData.imageUrls.length} potential image URLs`
              );
              data.imageUrls = extractData.imageUrls;
              data.locationData = extractData.locationData; // Include location data
            }

            // Analyze image URLs
            updateProgress(
              70,
              "Getting image metadata...",
              "Checking content types and file sizes..."
            );

            const analyzeResponse = await fetch(
              "http://localhost:3000/api/analyze-images",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  urls: data.imageUrls,
                  locationData: data.locationData, // Pass location data to analyzer
                }),
              }
            );

            if (!analyzeResponse.ok) {
              const errorText = await analyzeResponse.text();
              if (analyzeResponse.status === 413) {
                throw new Error(
                  "Request too large. Please reduce the number of URLs and try again."
                );
              }
              throw new Error(
                `Failed to analyze images: ${analyzeResponse.status} - ${errorText}`
              );
            }

            const analyzeData = await analyzeResponse.json();

            updateProgress(
              95,
              "Processing results...",
              "Filtering and formatting data..."
            );

            // Process results - only include successful ones (filtered content types are removed)
            const results = analyzeData.results.map((item, index) => ({
              url: item.url,
              filename: getFilename(item.url),
              type: getImageType(item.url),
              contentType: item.contentType || "Unknown",
              sizeBytes: item.sizeBytes || 0,
              sizeKB: item.sizeBytes
                ? (item.sizeBytes / 1024).toFixed(2)
                : "N/A",
              sizeMB: item.sizeBytes
                ? (item.sizeBytes / (1024 * 1024)).toFixed(3)
                : "N/A",
              success: item.success,
              status: item.success ? "Success" : item.error || "Failed",
              locationInfo: item.locationInfo || null, // Include location info
            }));

            // Calculate statistics and add analysis type
            const endTime = Date.now();
            const generationTime = ((endTime - startTime) / 1000).toFixed(2);
            const stats = calculateStats(results, data.websiteUrl || "Unknown");
            stats.generationTime = generationTime;
            stats.analysisType =
              data.mode === "url" ? "Images Analyzer" : "Image URLs Analysis";
            stats.originalWebsiteUrl = data.websiteUrl || null;
            stats.highlightSize = data.highlightSize || null; // Add highlight size to stats

            // For Image URLs Analysis, extract base website from the provided URLs
            if (
              data.mode === "urls" &&
              data.imageUrls &&
              data.imageUrls.length > 0
            ) {
              const extractedBaseUrl = extractBaseWebsiteFromUrls(
                data.imageUrls
              );
              if (extractedBaseUrl) {
                stats.originalWebsiteUrl = extractedBaseUrl;
                stats.extractedWebsiteName = getWebsiteName(extractedBaseUrl);
              }
            }

            updateProgress(
              100,
              "Analysis complete!",
              `Found ${results.length} valid images in ${generationTime}s`
            );

            analysisResult = { results, stats, summary: analyzeData.summary };

            // Show results preview
            setTimeout(() => {
              showResultsPreview(analysisResult);
            }, 500);

            return analysisResult;
          } catch (error) {
            console.error("Analysis error:", error);
            updateProgress(0, "Error occurred", error.message);
            throw error;
          } finally {
            setTimeout(() => {
              hideProgress();
            }, 1500);
          }
        }

        // Helper function to extract base website URL from image URLs
        function extractBaseWebsiteFromUrls(urls) {
          const domains = new Map();

          urls.forEach((url) => {
            try {
              const urlObj = new URL(url);
              const domain = urlObj.hostname;
              const baseUrl = `${urlObj.protocol}//${domain}`;
              domains.set(domain, baseUrl);
            } catch (e) {
              // Skip invalid URLs
            }
          });

          if (domains.size === 0) return null;

          // Return the most common domain, or first one if tie
          const domainArray = Array.from(domains.entries());
          return domainArray[0][1]; // Return base URL of first domain
        }

        function getFilename(url) {
          try {
            const path = new URL(url).pathname;
            return path.split("/").pop() || "Unnamed";
          } catch {
            return "Unnamed";
          }
        }

        function getImageType(url) {
          const extension = url.split(".").pop().toLowerCase().split("?")[0];
          const typeMap = {
            jpg: "JPEG",
            jpeg: "JPEG",
            png: "PNG",
            gif: "GIF",
            webp: "WebP",
            svg: "SVG",
            ico: "Icon",
            bmp: "BMP",
            tiff: "TIFF",
            tif: "TIFF",
            avif: "AVIF",
            heic: "HEIC",
            heif: "HEIF",
            jxl: "JPEG XL",
            jp2: "JPEG 2000",
            jpx: "JPEG 2000",
            j2k: "JPEG 2000",
            wdp: "HD Photo",
            jxr: "JPEG XR",
          };
          return typeMap[extension] || "Unknown";
        }

        function getWebsiteName(url) {
          try {
            return new URL(url).hostname.replace("www.", "").split(".")[0];
          } catch {
            return "website";
          }
        }

        function calculateStats(results, websiteUrl) {
          // Only count successful results (filtered content types are already removed)
          const validResults = results.filter((r) => r.success);
          const totalImages = validResults.length;
          const successful = validResults.length;
          const failed = results.length - validResults.length;

          const totalSizeBytes = validResults.reduce(
            (sum, r) => sum + r.sizeBytes,
            0
          );

          const totalSizeKB = (totalSizeBytes / 1024).toFixed(2);
          const totalSizeMB = (totalSizeBytes / (1024 * 1024)).toFixed(2);

          const typeStats = {};
          validResults.forEach((item) => {
            typeStats[item.type] = (typeStats[item.type] || 0) + 1;
          });

          // For Image URLs Analysis, use a generic name since URLs might be from multiple sites
          // The actual extracted website name will be set in analyzeImages function
          let websiteName;
          if (websiteUrl && websiteUrl !== "Unknown") {
            websiteName = getWebsiteName(websiteUrl);
          } else {
            websiteName = "image-analysis";
          }

          return {
            totalImages,
            successful,
            failed,
            totalSizeBytes,
            totalSizeKB,
            totalSizeMB,
            typeStats,
            websiteName,
            // analysisType and originalWebsiteUrl will be added in analyzeImages function
          };
        }

        function showResultsPreview(analysis) {
          const { results, stats, summary } = analysis;

          // Different display based on analysis type
          const isWebsiteAnalysis = stats.analysisType === "Images Analyzer";

          // Update stats container with different info for each type
          if (isWebsiteAnalysis) {
            statsContainer.innerHTML = `
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                <div class="text-sm text-gray-500">Valid Images</div>
                <div class="text-2xl font-bold text-blue-600">${
                  results.length
                }</div>
              </div>
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                <div class="text-sm text-gray-500">Total Size</div>
                <div class="text-2xl font-bold text-green-600">${
                  stats.totalSizeMB
                } MB</div>
              </div>
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-red-500">
                <div class="text-sm text-gray-500">Filtered Out</div>
                <div class="text-2xl font-bold text-red-600">${
                  summary?.filtered || 0
                }</div>
              </div>
            `;
          } else {
            // Image URLs Analysis - Different focus
            statsContainer.innerHTML = `
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-orange-500">
                <div class="text-sm text-gray-500">Processed URLs</div>
                <div class="text-2xl font-bold text-orange-600">${
                  results.length
                }</div>
              </div>
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                <div class="text-sm text-gray-500">Total Size</div>
                <div class="text-2xl font-bold text-blue-600">${
                  stats.totalSizeMB
                } MB</div>
              </div>
              <div class="bg-white p-4 rounded-lg shadow border-l-4 border-purple-500">
                <div class="text-sm text-gray-500">Success Rate</div>
                <div class="text-2xl font-bold text-purple-600">${Math.round(
                  (results.length /
                    (summary?.totalProcessed || results.length)) *
                    100
                )}%</div>
              </div>
            `;
          }

          // Update results table (show all results with location info)
          resultsTable.innerHTML = "";
          results.forEach((item, index) => {
            const row = document.createElement("tr");
            row.className = item.success ? "" : "bg-red-50";

            row.innerHTML = `
              <td>${index + 1}</td>
              <td>
                ${
                  item.success
                    ? `<img src="${item.url}" class="image-preview" alt="Preview" onerror="this.parentNode.innerHTML='Failed to load'">`
                    : "Failed to load"
                }
              </td>
              <td>${item.filename}</td>
              <td>${item.success ? item.sizeKB : "N/A"}</td>
              <td>${item.type}</td>
              <td><span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">${
                item.contentType || "Unknown"
              }</span></td>
              <td><span class="px-2 py-1 text-xs rounded-full ${
                item.success
                  ? "bg-green-100 text-green-800"
                  : "bg-red-100 text-red-800"
              }">${item.status}</span></td>
            `;

            resultsTable.appendChild(row);
          });

          // Show different filtering summaries based on analysis type
          if (summary && summary.filtered > 0) {
            const filteringSummary = document.createElement("div");
            filteringSummary.className =
              "mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded";

            if (isWebsiteAnalysis) {
              filteringSummary.innerHTML = `
                <h4 class="font-semibold text-yellow-800 mb-2">Website Scraping Summary</h4>
                <p class="text-sm text-yellow-700">Extracted from website and filtered out ${summary.filtered} non-image URLs (HTML pages, CSS files, etc.)</p>
              `;
            } else {
              const websiteInfo = stats.extractedWebsiteName
                ? ` from ${stats.extractedWebsiteName}`
                : "";
              filteringSummary.innerHTML = `
                <h4 class="font-semibold text-yellow-800 mb-2">URL Processing Summary</h4>
                <p class="text-sm text-yellow-700">Analyzed ${summary.totalProcessed} URLs${websiteInfo} and filtered out ${summary.filtered} non-image content types.</p>
              `;
            }

            resultsPreview.appendChild(filteringSummary);
          }

          resultsPreview.classList.remove("hidden");
        }

        // Generate HTML report (Enhanced with location information)
        function generateHTMLReport(analysis) {
          const { results, stats } = analysis;
          const currentDate = new Date().toLocaleString();

          // Only use successful results (filtered content types are already removed)
          const validResults = results.filter((r) => r.success);
          const sortedResults = [...validResults].sort(
            (a, b) => b.sizeBytes - a.sizeBytes
          );

          // Use the original website URL if available, otherwise extract from image URLs
          let websiteUrl = "#";
          let websiteDisplayName = stats.websiteName;

          if (stats.originalWebsiteUrl) {
            websiteUrl = stats.originalWebsiteUrl;
            if (stats.analysisType === "Images Analyzer") {
              websiteDisplayName = stats.websiteName;
            } else {
              // For Image URLs Analysis, show the extracted website name
              websiteDisplayName =
                stats.extractedWebsiteName ||
                getWebsiteName(stats.originalWebsiteUrl);
            }
          } else if (stats.analysisType === "Image URLs Analysis") {
            websiteUrl = "#";
            websiteDisplayName = "Mixed Sources";
          }

          // Generate HTML content with enhanced location information
          return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Image Analysis Report - ${stats.websiteName}</title>
    <style>
        :root {
            --primary-color: #2b6cb0;
            --primary-light: #4299e1;
            --secondary-color: #cbd5e0;
            --dark-color: #2d3748;
            --light-color: #f7fafc;
            --danger-color: #e53e3e;
            --success-color: #38a169;
            --warning-color: #ecc94b;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
            background-color: #f9fafb;
        }

        .container {
            padding: 20px;
        }

        h1, h2, h3 {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 2.2rem;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            display: inline-block;
        }

        h2 {
            font-size: 1.8rem;
            position: relative;
        }

        h2::after {
            content: '';
            display: block;
            width: 50px;
            height: 4px;
            background: var(--primary-light);
            margin-top: 8px;
        }

        .report-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .report-header::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .report-header h1 {
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .report-header p {
            margin-bottom: 10px;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .report-header strong {
            opacity: 1;
        }

        .website-link {
    color: #ffb700;
    text-decoration: underline;
    transition: var(--transition);
}

.website-link:hover {
    color: #ff6a00;
}

        .stats-container {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .stats-title {
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        .summary-items {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .summary-item {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            margin: 10px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
            text-align: center;
        }

        .summary-item strong {
            display: block;
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .summary-item span {
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .stats-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stats-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            min-width: 160px;
            flex-grow: 1;
            text-align: center;
            border-bottom: 3px solid var(--primary-light);
        }

        .stats-item strong {
            display: block;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .stats-item span {
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .table-container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 0 auto;
            font-size: 0.9rem;
            table-layout: fixed;
        }

        th, td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
            height: 70px; /* Adjusted for location info only */
            vertical-align: middle;
            overflow: hidden;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
            font-weight: 600;
            height: auto;
        }





        .url-cell {
            width: 35%; /* Adjusted for location columns */
            max-width: 35%;
            word-break: break-all;
            font-size: 0.85rem;
            position: relative;
        }

        .url-truncated {
            display: block;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-decoration: none;
            color: var(--primary-color);
            transition: var(--transition);
            position: relative;
        }

        .url-truncated:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        .url-truncated::after {
            content: '...';
            position: absolute;
            right: 0;
            background: linear-gradient(to right, transparent, #fff 70%);
            padding-left: 20px;
            width: 30px;
        }

        tr:nth-child(even) .url-truncated::after {
            background: linear-gradient(to right, transparent, #f8f9fa 70%);
        }

        tr:hover .url-truncated::after {
            background: linear-gradient(to right, transparent, #ebf8ff 70%);
        }

        /* Highlighting for large images - changed to red */
.highlighted-row {
    background-color: #fee2e2 !important;
    border-left: 4px solid #dc2626 !important;
}

.highlighted-row:hover {
    background-color: #fecaca !important;
}

.highlighted-row .url-truncated::after {
    background: linear-gradient(to right, transparent, #fee2e2 70%) !important;
}

.highlighted-row:hover .url-truncated::after {
    background: linear-gradient(to right, transparent, #fecaca 70%) !important;
}

        .filename-cell { width: 15%; max-width: 15%; word-break: break-all; }
        .preview-cell { width: 8%; text-align: center; }
        .location-cell { width: 12%; }
        .position-cell { width: 10%; font-size: 0.8rem; }
        .size-cell { width: 8%; text-align: right; }
        .type-cell { width: 8%; text-align: center; }
        .content-type-cell { width: 12%; text-align: center; }
        .status-cell { width: 8%; text-align: center; }

        .image-link {
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
            display: block;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
        }

        .image-link:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        .image-preview {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border: 2px solid #ddd;
            border-radius: 4px;
            transition: transform 0.3s ease;
        }

        .image-preview:hover {
            transform: scale(2);
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .status-success { 
            color: var(--success-color); 
            font-weight: bold; 
        }
        
        .status-error { 
            color: var(--danger-color); 
            font-weight: bold; 
        }

        .footer {
            font-size: 0.9rem;
            color: #6c757d;
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #dee2e6;
            background-color: white;
            border-radius: var(--border-radius);
        }

        @media only screen and (max-width: 768px) {
            .summary-items {
                flex-direction: column;
            }
            
            .summary-item {
                margin: 5px 0;
                min-width: 100%;
            }
            
            .table-container {
                padding: 15px 10px;
            }
            
            th, td {
                padding: 10px;
            }
            
            .report-header {
                padding: 20px;
            }

            .image-preview {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="report-header">
            <h1>Enhanced Image Analysis Report</h1>
            <p><strong>Website:</strong> <a href="${websiteUrl}" class="website-link" target="_blank">${websiteDisplayName}</a></p>
            <p><strong>Analysis Date:</strong> ${currentDate}</p>
            <p><strong>Tool:</strong> ${stats.analysisType}</p>
            ${
              stats.highlightSize
                ? `<p><strong>Highlighting:</strong> <span style="color: #dc2626;">Images ‚â• ${stats.highlightSize} KB</span> are highlighted in red</p>`
                : ""
            }
        </div>

        <h2>Image Statistics</h2>
        <div class="stats-container">
 <div class="summary-items">
    <div class="summary-item">
        <strong>${validResults.length}</strong>
        <span>Valid Images Found</span>
    </div>
    <div class="summary-item">
        <strong>${stats.totalSizeKB} KB</strong>
        <span>Total Size</span>
    </div>
    <div class="summary-item">
        ${
          stats.highlightSize && stats.highlightSize > 0
            ? `<strong style="color: #dc2626;">${
                validResults.filter(
                  (r) =>
                    r.sizeBytes && r.sizeBytes / 1024 >= stats.highlightSize
                ).length
              }</strong>
            <span>Images > ${stats.highlightSize} KB</span>`
            : `<strong>${stats.successful}</strong>
            <span>Successfully Loaded</span>`
        }
    </div>
</div>

            <div class="stats-title">Distribution by Image Format</div>
            <div class="stats-grid">
                ${Object.entries(stats.typeStats)
                  .map(([type, count]) => {
                    const percentage = (
                      (count / validResults.length) *
                      100
                    ).toFixed(1);
                    return `
                    <div class="stats-item">
                        <strong>${count}</strong>
                        <span>${type} (${percentage}%)</span>
                    </div>
                  `;
                  })
                  .join("")}
            </div>
        </div>

        <h2>Image Results (Sorted by Size)</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th class="preview-cell">Preview</th>
                        <th class="filename-cell">Filename</th>
                        <th class="type-cell">Type</th>
                        <th class="content-type-cell">Content Type</th>
                        <th class="size-cell">Size (KB)</th>
                        <th class="status-cell">Status</th>
                        <th class="url-cell">URL</th>
                    </tr>
                </thead>
                <tbody>
                    ${sortedResults
                      .map((item, index) => {
                        const statusClass = item.success
                          ? "status-success"
                          : "status-error";
                        const previewHtml = item.success
                          ? `<img src="${item.url}" class="image-preview" alt="Preview" onerror="this.style.display='none'">`
                          : '<span style="color: #999; font-size: 0.8rem;">No Preview</span>';

                        // Truncate URL for display but keep full URL in href
                        const displayUrl =
                          item.url.length > 60
                            ? item.url.substring(0, 57)
                            : item.url;

                        // Check if this row should be highlighted
                        const shouldHighlight =
                          stats.highlightSize &&
                          item.success &&
                          item.sizeBytes &&
                          item.sizeBytes / 1024 >= stats.highlightSize;

                        const rowClass = shouldHighlight
                          ? "highlighted-row"
                          : "";

                        return `
                        <tr class="${rowClass}">
                            <td style="width: 5%; text-align: center;">${
                              index + 1
                            }</td>
                            <td class="preview-cell">${previewHtml}</td>
                            <td class="filename-cell">${item.filename}</td>
                            <td class="type-cell">${item.type}</td>
                            <td class="content-type-cell">${
                              item.contentType || "Unknown"
                            }</td>
                            <td class="size-cell">${item.sizeKB}</td>
                            <td class="status-cell ${statusClass}">${
                          item.status
                        }</td>
                            <td class="url-cell">
                              <a href="${
                                item.url
                              }" class="url-truncated" target="_blank" title="${
                          item.url
                        }">
                                ${displayUrl}
                              </a>
                            </td>
                        </tr>
                      `;
                      })
                      .join("")}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>`;
        }

        // Generate CSV report (Enhanced with location data)
        function generateCSVReport(analysis) {
          const { results, stats } = analysis;
          const currentDate = new Date().toLocaleString();

          // Only use successful results (filtered content types are already removed)
          const validResults = results.filter((r) => r.success);

          // For CSV, show proper website name or extracted website name for Image URLs Analysis
          let csvWebsiteName = stats.websiteName;
          if (stats.analysisType === "Image URLs Analysis") {
            csvWebsiteName =
              stats.extractedWebsiteName || "Image URLs Analysis";
          }

          // CSV Header with analysis info
          let csvContent = `Website,${csvWebsiteName}\n`;
          csvContent += `Date,${currentDate}\n`;
          csvContent += `Tool,${stats.analysisType}\n`;
          csvContent += `Valid Images,${validResults.length}\n`;
          csvContent += `Total Size,${stats.totalSizeKB} KB\n`;
          csvContent += `\n`; // Empty line

          // Image Format Statistics Header
          csvContent += `=== Image Format Statistics ===\n`;
          Object.entries(stats.typeStats).forEach(([type, count]) => {
            const percentage = ((count / validResults.length) * 100).toFixed(1);
            csvContent += `${type},${count} (${percentage}%)\n`;
          });
          csvContent += `\n`; // Empty line

          // Main data table header
          csvContent += `Filename,Type,Content Type,Size (KB),Status,URL\n`;

          // Data rows
          validResults.forEach((item) => {
            // Escape commas and quotes in CSV data
            const filename = `"${item.filename.replace(/"/g, '""')}"`;
            const type = item.type;
            const contentType = `"${(item.contentType || "Unknown").replace(
              /"/g,
              '""'
            )}"`;
            const sizeKB = item.sizeKB || "N/A";
            const status = item.status;
            const url = `"${item.url.replace(/"/g, '""')}"`;

            csvContent += `${filename},${type},${contentType},${sizeKB},${status},${url}\n`;
          });

          return csvContent;
        }

        // Download file helper
        function downloadFile(filename, content, contentType) {
          const blob = new Blob([content], { type: contentType });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, 100);
        }

        // Event listeners for download buttons
        downloadHTML.addEventListener("click", async function () {
          const data = getInputData();
          if (!validateInput(data)) return;

          downloadHTML.disabled = true;
          downloadCSV.disabled = true;

          try {
            const analysis = await analyzeImages(data, "html");
            const htmlReport = generateHTMLReport(analysis);

            // Use extracted website name for filename if available
            let filenameSite = analysis.stats.websiteName;
            if (analysis.stats.extractedWebsiteName) {
              filenameSite = analysis.stats.extractedWebsiteName;
            }

            const filename = `${filenameSite}-images-analyze-${
              new Date().toISOString().split("T")[0]
            }.html`;
            downloadFile(filename, htmlReport, "text/html");
          } catch (error) {
            console.error("Error generating HTML report:", error);
            alert(
              error.message || "An error occurred while generating the report."
            );
          } finally {
            downloadHTML.disabled = false;
            downloadCSV.disabled = false;
          }
        });

        downloadCSV.addEventListener("click", async function () {
          const data = getInputData();
          if (!validateInput(data)) return;

          downloadHTML.disabled = true;
          downloadCSV.disabled = true;

          try {
            const analysis = await analyzeImages(data, "csv");
            const csvReport = generateCSVReport(analysis);

            // Use extracted website name for filename if available
            let filenameSite = analysis.stats.websiteName;
            if (analysis.stats.extractedWebsiteName) {
              filenameSite = analysis.stats.extractedWebsiteName;
            }

            const filename = `${filenameSite}-images-analyze-${
              new Date().toISOString().split("T")[0]
            }.csv`;
            downloadFile(filename, csvReport, "text/csv");
          } catch (error) {
            console.error("Error generating CSV report:", error);
            alert(
              error.message || "An error occurred while generating the report."
            );
          } finally {
            downloadHTML.disabled = false;
            downloadCSV.disabled = false;
          }
        });
      }
    </script>
  </body>
</html>
